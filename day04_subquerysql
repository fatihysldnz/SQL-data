------ SUBQUERY ------
-- Sorgu icinde calisan saorguya subquery (alt sorgu) denir.

CREATE TABLE personel1
    (
        id NUMBER(9),
        isim VARCHAR2(50),
        sehir VARCHAR2(50),
        maas NUMBER(20),
        sirket VARCHAR2(20)
    );
    INSERT INTO personel1 VALUES(123456789, 'Ali Seker', 'Istanbul', 2500, 'Honda');
    INSERT INTO personel1 VALUES(234567890, 'Ayse Gul', 'Istanbul', 1500, 'Toyota');
    INSERT INTO personel1 VALUES(345678901, 'Veli Yilmaz', 'Ankara', 3000, 'Honda');
    INSERT INTO personel1 VALUES(456789012, 'Veli Yilmaz', 'Izmir', 1000, 'Ford');
    INSERT INTO personel1 VALUES(567890123, 'Veli Yilmaz', 'Ankara', 7000, 'Hyundai');
    INSERT INTO personel1 VALUES(456789012, 'Ayse Gul', 'Ankara', 1500, 'Ford');
    INSERT INTO personel1 VALUES(123456710, 'Fatma Yasa', 'Bursa', 2500, 'Honda');
   
    CREATE TABLE sirketler(
        sirket_id NUMBER(9),
        sirket_adi VARCHAR2(20),
        personel_sayisi NUMBER(20)
    );
    INSERT INTO sirketler VALUES(100, 'Honda', 12000);
    INSERT INTO sirketler VALUES(101, 'Ford', 18000);
    INSERT INTO sirketler VALUES(102, 'Hyundai', 10000);
    INSERT INTO sirketler VALUES(103, 'Toyota', 21000);
    INSERT INTO sirketler VALUES(104, 'Mazda', 17000);
    
    SELECT *FROM sirketler;
    SELECT * FROM personel1;
    
    --ORNEK1: PERSONEL SAYISI 15.000’den COK OLAN SÝRKETLERÝN ÝSÝMLERÝNÝ (alt sorgu þirketler)ve bu
  --sirkette calisan personelin isimlerini ve maaþlarýný (asýl sorgu personel) listeleyin
  SELECT isim, maas, sirket FROM personel1
  where sirket IN (select sirket_adi from sirketler 
                where personel_sayisi>15000);
  
 -- ORNEK2: sirket_id’si 101’den büyük olan þirket çalýþanlarýnýn isim, maaþ ve
 -- þehirlerini listeleyiniz
  SELECT isim, maas, sehir FROM personel1
  where sirket IN (select sirket_adi from sirketler 
                where sirket_id>101);
  
  --ORNEK3: Ankara’da personeli olan þirketlerin þirket id'lerini ve personel
 -- sayýlarýný listeleyiniz
  select sirket_id, personel_sayisi from sirketler
  where sirket_adi IN (select sirket from personel1
                        where sehir='Ankara');
                        
                        
                        /* ===================== AGGREGATE METOT KULLANIMI ===========================
    Aggregate Metotlarý(SUM,COUNT, MIN,MAX, AVG) Subquery içinde kullanýlabilir.
    Ancak, Sorgu tek bir deðer döndürüyor olmalýdýr.
-- *** SELECT den sonra SUBQUERY yazarsak sorgu sonucunun sadece 1 deger getireceginden emin olmaliyiz--SELECT id,isim,maas
                                                                                                        --FROM personel
                                                                                                      --WHERE sirket='Honda';
-- bir tablodan tek deger getirebilmek icin ortalama AVG , toplam SUM, adet COUNT, MIN, MAX  gibi
-- fonksiyonlar kullanilir ve bu fonksiyonlara AGGREGATE FONKSIYONLAR denir
==============================================================================*/   
  
--  ORNEK4: Her þirketin ismini, personel sayýsýný ve o þirkete ait personelin
--  toplam maaþýný listeleyen bir Sorgu yazýnýz.
  
  SELECT sirket_adi, personel_sayisi, (select sum(maas) from personel1      -- SUM toplam verir
                                        WHERE sirketler.sirket_adi=personel1.sirket) AS maas_toplami --sum yapilan satira isim vermek icin
    FROM sirketler ;                                                                                   -- AS yazsak da yazmasak da olur
  
  
--  ORNEK5: Her þirketin ismini, personel sayýsýný ve o þirkete ait personelin
 -- ortalama maaþýný listeleyen bir Sorgu yazýnýz.
 
 SELECT sirket_adi, personel_sayisi, (select ROUND (AVG(maas)) from personel1 --AVG ortlama verir
                                        WHERE sirketler.sirket_adi=personel1.sirket) maas_ortalamasi
                        FROm sirketler;
 
-- ORNEK6: Her þirketin ismini, personel sayýsýný ve o þirkete ait personelin
--  maksimum ve minumum maaþýný listeleyen bir Sorgu yazýnýz.

SELECT sirket_adi, personel_sayisi, (select  max(maas) from personel1 --mýn max
                                        WHERE sirketler.sirket_adi=personel1.sirket) AS max_maas,
                                        (select  MIN(maas) from personel1 --mýn max
                                        WHERE sirketler.sirket_adi=personel1.sirket) AS min_maas
                        FROm sirketler;

--ORNEK7: Her sirketin id’sini, ismini ve toplam kaç þehirde bulunduðunu
--  listeleyen bir SORGU yazýnýz.

SELECT sirket_id, sirket_adi, (Select count(sehir) from personel1 --COUNT saydirmak icin kullanilir
                                WHERE sirket_adi=sirket) kac_sehirde_var
                                
                    from sirketler;
                    
                    
--*********ODEV SORULARII********Ð
--1)sirket id, sirket ismi, sirketteki min maas, sirketteki max maas, sirketteki ort.maas lari yazdirin
    --2) izmir,istanbul veya bursada personeli bulunan sirketlerin calisan sayilarini listeleyin
    -- 3)izmirde calisan Veli YIlmaz'in maasini 2000 yapin
    -- 4)personel sayisi 10000 olan sirketten personel  tablosunda bulunan kisinin maasini 6000 yapin

--1.cozum
SELECT sirket_id, sirket_adi, (select  max(maas) from personel1 --mýn max
                                        WHERE sirketler.sirket_adi=personel1.sirket) AS max_maas,
                                        (select  MIN(maas) from personel1 --mýn max
                                        WHERE sirketler.sirket_adi=personel1.sirket) AS min_maas,
                                        (select ROUND (AVG(maas)) from personel1 --AVG ortlama verir
                                        WHERE sirketler.sirket_adi=personel1.sirket) maas_ortalamasi
                        FROm sirketler;
                        
--2.cozum
SELECT sirket_adi, personel_sayisi from sirketler
where sirket_adi IN (Select sirket from personel1 where sehir IN ('Izmir','Istanbul','Bursa'));

--3.cozum


--4.cozum
update personel1
set maas=6000
where sirket=(select sirket_adi from sirketler where personel_sayisi=10000);

SELECT * FROM personel1;

  
  